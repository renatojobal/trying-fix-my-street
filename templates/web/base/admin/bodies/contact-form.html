<form method="post" action="[% c.uri_for_action('admin/bodies/edit', [ body_id ] ) %]" enctype="application/x-www-form-urlencoded" accept-charset="utf-8" id="category_edit">

  [% IF contact.in_storage %]
    <p>
      <h1>[% contact.category_display | html %]</h1>
      <input type="hidden" name="category" value="[% contact.category | html %]" >
    </p>
  [% ELSE %]
    <div class="admin-hint">
      <p>
          [% loc('Choose a <strong>category</strong> name that makes sense to the public (e.g., "Pothole", "Street lighting") but is helpful
                  to the body too. These will appear in the drop-down menu on the report-a-problem page.') %]
          <br>
          [% loc("If two or more bodies serve the same location, FixMyStreet combines identical categories into a single entry in
                  the menu. Make sure you use the same category name in the bodies if you want this to happen.") %]
      </p>
    </div>
    <p>
      <strong>[% loc('Category') %] </strong><input type="text" class="form-control" name="category" size="30" value="[% contact.category | html %]" required>
    </p>
  [% END %]

  [% INCLUDE 'admin/bodies/_translations.html' %]

    <label for="destination">[% loc('Destination') %]</label>
    <p class="form-hint" id="destination-hint">
      [% IF body.can_be_devolved %]
        [% loc('An email address or service ID (Open311 or similar).') %]
      [% ELSIF body.send_method == 'Open311' %]
        [% loc('A service ID (Open311 or similar).') %]
      [% ELSIF body.send_method.match('Email') OR NOT body.send_method %]
        [% loc('An email address.') %]
      [% ELSE %]
        [% loc('An email address or service ID (Open311 or similar).') %]
      [% END %]
    </p>
    <input type="text" class="form-control" id="destination" aria-describedby="destination-hint" name="email" size="30" value="[% contact.email | html %]" required>

    <fieldset>
        <legend>[% loc('State') %]</legend>
        <div class="form-check form-check--inline">
            <input type="radio" name="state" id="state-unconfirmed" aria-describedby="state-unconfirmed-hint" value="unconfirmed"[% ' checked' IF contact.state == 'unconfirmed' %]>
            <label for="state-unconfirmed">[% loc('Unconfirmed') %]</label>
            <p class="form-hint" id="state-unconfirmed-hint">[% loc('You are not sure of the origin or validity of the contact.') %]</p>
        </div>
        <div class="form-check form-check--inline">
            <input type="radio" name="state" id="state-confirmed" aria-describedby="state-confirmed-hint" value="confirmed"[% ' checked' IF contact.state == 'confirmed' || contact.state == "" %]>
            <label for="state-confirmed">[% loc('Confirmed') %]</label>
            <p class="form-hint" id="state-confirmed-hint">[% loc('The contact has been confirmed as correct.') %]</p>
        </div>
        <div class="form-check form-check--inline">
            <input type="radio" name="state" id="state-inactive" aria-describedby="state-inactive-hint" value="inactive"[% ' checked' IF contact.state == 'inactive' %]>
            <label for="state-inactive">[% loc('Inactive') %]</label>
            <p class="form-hint" id="state-inactive-hint">[% loc('Prevent new reports from using this category, but keep it available in map filters.') %]</p>
        </div>
        <div class="form-check form-check--inline">
            <input type="radio" name="state" id="state-deleted" aria-describedby="state-deleted-hint" value="deleted"[% ' checked' IF contact.state == 'deleted' %]>
            <label for="state-deleted">[% loc('Deleted') %]</label>
            <p class="form-hint" id="state-deleted-hint">[% loc('Prevent new reports from using this category, <em>and</em> also remove it from map filters.') %]</p>
        </div>
    </fieldset>

    <p class="form-check">
        <input type="checkbox" name="non_public" value="1" id="non_public" [% ' checked' IF contact.non_public %]>
        <label for="non_public">[% loc('Hide reports made in this category') %]</label>
        <span class='form-hint'>[% loc('Use this for issues that you want to allow users to report, but for which there is no public interest in displaying the report, like requesting an extra rubbish bin at a specific address.') %]</span>
    </p>

    <p class="form-check">
        <input type="checkbox" name="disable" value="1" id="disable" data-toggle-visibility="#js-disable-form-message-box" [% ' checked' IF contact.disable_form_field %]>
        <label for="disable">[% loc('Disable form when this category is selected') %]</label>
    </p>

    <p class="form-group form-group--indented [% 'hidden-js' IF NOT contact.disable_form_field %]" id="js-disable-form-message-box">
        <label for="disabled-message">[% loc('Message to show when form is disabled (HTML permitted)') %]</label>
        <textarea id="disabled-message" name="disable_message" class="form-control">[% contact.disable_form_field.description %]</textarea>
    </p>

    <p class="form-check">
        <input type="checkbox" name="inspection_required" value="1" id="inspection_required" data-toggle-visibility="#js-inspection-reputation-box" [% 'checked' IF contact.get_extra_metadata('inspection_required') %]>
        <label for="inspection_required">[% loc('Reports in this category must be inspected before being sent') %]</label>
    </p>

    <p class="form-group form-group--indented [% 'hidden-js' IF NOT contact.get_extra_metadata('inspection_required') %]" id="js-inspection-reputation-box">
        <label for="reputation_threshold">[% loc('Reputation threshold') %]</label>
        <span class="form-hint" id="reputation_threshold_hint">
            [% loc("Reports will automatically be sent without needing to be inspected if the user's <strong>reputation</strong> is at or above this value. Set to <strong>0</strong> if all reports must be inspected regardless.") %]
        </span>
        <input type="text" class="form-control" name="reputation_threshold" id="reputation_threshold"
            value="[% contact.get_extra_metadata('reputation_threshold') | html %]" size="30"
            aria-describedby="reputation_threshold_hint">
    </p>

  [% IF body.can_be_devolved %]
    <div class="admin-hint">
      <p>
        [% loc(
          "The <strong>send method</strong> determines how problem reports will be sent to the body.
           If you leave this blank, <strong>send method defaults to email</strong>."
        ) %]
      </p>
    </div>
    <p>
        <label for="send_method">Send Method</label>
        <select class="form-control" name="send_method" id="send_method">
            <option value=""> -- Select a method -- </option>
            [% FOR method IN send_methods %]
            <option value="[% method %]"[% ' selected' IF contact.send_method == method %]>[% method %]</option>
            [% END %]
        </select>
    </p>

    [% INCLUDE 'admin/bodies/open311-form-fields.html', object = contact%]
  [% END %]

  [% IF c.cobrand.enable_category_groups %]
    <p>
      <label>
        [% loc('Parent categories') %]
        [% IF contact.extra.group %]
            [% FOR group IN contact.extra.group %]
            <input class="form-control" type="text" name="group" value="[% group | html %]" size="30">
            [% END %]
        [% ELSE %]
            <input class="form-control" type="text" name="group" value="" size="30">
        [% END %]
        <input class="hidden-js js-group-item-template form-control" type="text" name="group" value="" size="30">
        <p class="hidden-nojs">
          <button type="button" class="btn btn--small js-group-item-add">[% loc('Add another parent category') %]</button>
        </p>
      </label>
    </p>
  [% END %]

    <h2>[% loc('Extra data:') %] </h2>
    <dl>
      [% FOR pair IN contact.get_extra_metadata %]
        <dt>[% pair.key %]</dt> <dd>[% pair.value OR '<em>-</em>' %]</dd>
      [% END %]
    </dl>
    [% INCLUDE 'admin/extra-metadata-form.html' metas=(contact.get_metadata_for_editing OR []) %]

    <p class="form-group" style="margin-top: 2em">
        <label for="note">[% loc('Summarise your changes') %]</label>
        <span class="form-hint" id="note-hint">[% loc("If youâ€™ve made changes, leave a note explaining what, for other admins to see.") %]</span>
        <input class="form-control" type="text" id="note" name="note" size="30" aria-describedby="note-hint" required>
    </p>

  <p>
    <input type="hidden" name="posted" value="new" >
    <input type="hidden" name="token" value="[% csrf_token %]" >
    <input type="submit" class="btn" name="Create category" value="[% contact.in_storage ? loc('Save changes') : loc('Create category') %]" >
  </p>


</form>
